<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Dashboard Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container" id="app">
        <div id="loading" class="empty-state">
            <div class="loader"></div>
            <p>Waiting for context...</p>
        </div>
        <div id="no-data" class="empty-state" style="display: none;">
            <p>No wallet account found for this user.</p>
        </div>
        <div id="wallet-content" style="display: none;">
            <div class="profile-card">
                <img src="" alt="Avatar" class="avatar" id="user-avatar">
                <div class="user-info">
                    <h2 id="user-name"></h2>
                    <p class="email" id="user-email"></p>
                    <span class="status-badge" id="user-status"></span>
                </div>
            </div>
            <div class="balance-section">
                <div class="balance-label">Current Balance</div>
                <div class="balance-amount" id="user-balance"></div>
            </div>
            <div class="transactions-section">
                <div class="transactions-header">
                    <span>Recent Transactions</span>
                </div>
                <div class="transactions-list" id="transactions-list"></div>
            </div>
        </div>
    </div>

    <!-- Reuse the same app logic, but inject the event automatically -->
    <script type="module">
        import { mockData } from './mockData.js';

        // --- Same Logic as app.js ---
        const els = {
            loading: document.getElementById('loading'),
            noData: document.getElementById('no-data'),
            content: document.getElementById('wallet-content'),
            avatar: document.getElementById('user-avatar'),
            name: document.getElementById('user-name'),
            email: document.getElementById('user-email'),
            status: document.getElementById('user-status'),
            balance: document.getElementById('user-balance'),
            transactions: document.getElementById('transactions-list')
        };

        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency
            }).format(amount);
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function renderUser(user) {
            els.loading.style.display = 'none';
            els.noData.style.display = 'none';
            els.content.style.display = 'block';
            els.avatar.src = user.avatar;
            els.name.textContent = user.name;
            els.email.textContent = user.email;
            els.status.textContent = user.status;
            els.balance.textContent = formatCurrency(user.balance, user.currency);
            els.transactions.innerHTML = '';
            user.transactions.forEach(t => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                const isCredit = t.type === 'credit';
                const sign = isCredit ? '+' : '';
                const amountClass = isCredit ? 'credit' : 'debit';
                item.innerHTML = `
                    <div class="t-info">
                        <span class="t-desc">${t.description}</span>
                        <span class="t-date">${formatDate(t.date)}</span>
                    </div>
                    <div class="t-amount ${amountClass}">${sign}${formatCurrency(t.amount, user.currency)}</div>
                `;
                els.transactions.appendChild(item);
            });
        }

        // --- Automatic Injection after 500ms ---
        setTimeout(() => {
            console.log("Simulating event...");
            const user = mockData.find(u => u.email === 'test@example.com');
            if (user) renderUser(user);
        }, 500);
    </script>
</body>

</html>